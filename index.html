<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["dart","java","node","javascript","python","ruby","c"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="dart">Dart</a>
              <a href="#" data-language-name="java">Java</a>
              <a href="#" data-language-name="node">Node.js</a>
              <a href="#" data-language-name="javascript">Javascript</a>
              <a href="#" data-language-name="python">Python</a>
              <a href="#" data-language-name="ruby">Ruby</a>
              <a href="#" data-language-name="c">C</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='#'>Sign Up for a Developer Key</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>So you have some data that you would like to be able to send to a DGLux server
or DSA Broker, but youâ€™re not sure how to accomplish that? This guide will
introduce you to the basics of communicating with a Broker using the DSLink SDK.
We&rsquo;ll learn how to send data to a Broker as well as how to subscribe to data
to get updates when other, or even our, data is changed.</p>

<h1 id="importing">Importing</h1>

<blockquote>
<p>Use the following to import the SDK.</p>
</blockquote>
<pre class="highlight dart"><code><span class="c1">// pubspec.yaml</span>
<span class="nl">dependencies:</span>
  <span class="nl">dslink:</span>
    <span class="nl">git:</span> <span class="nl">git:</span><span class="c1">//github.com/IOT-DSA/sdk-dslink-dart.git</span>


<span class="c1">// run.dart</span>

<span class="kn">import</span> <span class="s">'package:dslink/dslink.dart'</span><span class="o">;</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">// TODO</span>
</code></pre>

<p>By using the Git repository, we ensure that we have the most up-to-date version
of the DSLink SDK. In the future, the SDK may be made available through common
package managers for each language.</p>

<h1 id="responder">Responder</h1>

<p>There are several types of DSLinks we can create. The first of which is called
a <em>Responder</em>. The Responder will provide data on demand. It will only send the
data when it&rsquo;s requested, eg it Responds.</p>

<aside class="notice">
The other types of Links are a <em>Requester</em> and a hybrid <em>Responder</em>
and <em>Requester</em>. We&rsquo;ll look at those types later.
</aside>

<h2 id="link">Link</h2>

<blockquote>
<p>Note that we pass the application startup arguments to the link creation.</p>
</blockquote>
<pre class="highlight dart"><code><span class="c1">// run.dart</span>

<span class="n">main</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">var</span> <span class="n">link</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkProvider</span><span class="o">(</span><span class="n">args</span><span class="o">,</span> <span class="s">'Example-'</span><span class="o">);</span>
  <span class="n">link</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
  <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre>

<p>In order to create any type of connection (Responder or Requester), we first
need to establish a link to the DSA Broker. In this example we will only
establish the bare minimum link. There are a number of configuration options
to further extend the capabilities. Refer to the documentation for the SDK
of the language of your choice.</p>

<p>The most basic Link will accept command line arguments passed the application
as well as a name for the Link. The ending hyphen is not optional, and will not
appear in the link. The name supplied here is what will show up under your
downstream connections (by default).</p>

<h2 id="nodes">Nodes</h2>

<p>Within the DSA Broker, all of our data is broken into a collection of nodes.
A node may be a link to a separate device, or it may be multiple links running
from a server. Each link may also have children nodes.</p>

<p>A node structure can be through of like a file directory tree on your computer
or a website&rsquo;s address/path. A Responder link will only have access to the nodes
it contains. As we will see later, a Requester can access any node that it has
permission to access.</p>

<h3 id="generate-a-random-number">Generate a Random Number</h3>

<blockquote>
<p>Generate a random number</p>
</blockquote>
<pre class="highlight dart"><code><span class="c1">// At the top of the file add the import for the Math library.</span>
<span class="kn">import</span> <span class="s">'dart:math'</span><span class="o">;</span>
<span class="c1">// ...</span>

<span class="kd">var</span> <span class="n">numGen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
<span class="kd">var</span> <span class="n">myNum</span> <span class="o">=</span> <span class="n">numGen</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
</code></pre>

<p>Before we add the new, lets create a value that we can pass, and send updates
for. In this case we&rsquo;ll just generate a random number between 0 and 50.</p>

<h3 id="add-node">Add node</h3>

<blockquote>
<p>Add the node to our responder link.</p>
</blockquote>
<pre class="highlight dart"><code><span class="kd">var</span> <span class="n">myNode</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">addNode</span><span class="o">(</span><span class="s">'/MyNum'</span><span class="o">,</span>
<span class="c1">// Note the raw strings, the $ must be passed as well.</span>
  <span class="o">{</span> <span class="sx">r'$name'</span><span class="o">:</span> <span class="s">'My Number'</span><span class="o">,</span>
    <span class="sx">r'$type'</span> <span class="o">:</span> <span class="s">'int'</span><span class="o">,</span>
    <span class="s">'?value'</span> <span class="o">:</span> <span class="n">myNum</span><span class="o">});</span>
</code></pre>

<p>Next we add our node to the Link. In this case we pass the node name, <code class="prettyprint">/MyNum</code>
and the configuration. The node name begins with a forward-slash (<code class="prettyprint">/</code>)
which indicate it is appended to the root of our DSLink.</p>

<p>In our node configuration, we provide a user friendly display name for our link,
this name will only appear in the the Link information, but does not affect the
name or path used when trying to access the value. Additionally we provide the
type of value that this node will provide, and the value itself, which is our
random number that we generated. For information on additional configuration
options for a node please refer to
<a href="https://github.com/IOT-DSA/docs/wiki/Configs">Node Configs</a></p>

<p>When we add the node, it will return a local copy of the node for us to work
with directly. Alternatively we can also perform many of the same operations
directly with link itself.</p>

<h2 id="updating-a-node">Updating a node</h2>
<pre class="highlight dart"><code><span class="k">new</span> <span class="n">Timer</span><span class="o">.</span><span class="na">periodic</span><span class="o">(</span><span class="kd">const</span> <span class="n">Duration</span><span class="o">(</span><span class="nl">seconds:</span> <span class="mi">5</span><span class="o">),</span> <span class="o">(</span><span class="n">_</span><span class="o">)</span> <span class="o">{</span>
<span class="c1">// To be filled in soon.</span>
<span class="o">});</span>
</code></pre>

<p>A node is of limited value if it only provides the initial request and nothing
further. We want to provide updates to the value as things change. For our
demonstration, we will setup a timer which updates our number once ever five
seconds.</p>

<h2 id="checking-for-a-subscription">Checking for a subscription</h2>

<blockquote>
<p>Add this to the timer function.</p>
</blockquote>
<pre class="highlight dart"><code><span class="k">if</span><span class="o">(</span><span class="n">myNode</span><span class="o">.</span><span class="na">hasSubscriber</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// To be filled in soon</span>
<span class="o">}</span>
</code></pre>

<p>Generally, if there is no one actively listening, or <em>subscribing</em> to our node
there is not a lot of reason to update the value. So first, we will check to
see if the node has a subscriber.</p>

<h2 id="updating-the-value">Updating the value</h2>

<blockquote>
<p>Update the random number then update our value.</p>
</blockquote>
<pre class="highlight dart"><code><span class="n">myNum</span> <span class="o">=</span> <span class="n">numGen</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
<span class="n">myNode</span><span class="o">.</span><span class="na">updateValue</span><span class="o">(</span><span class="n">myNum</span><span class="o">);</span>
</code></pre>

<p>Once we are sure someone is subscribed to changes in our node, we generate a
new random number, then update the value of our node.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="dart">Dart</a>
                <a href="#" data-language-name="java">Java</a>
                <a href="#" data-language-name="node">Node.js</a>
                <a href="#" data-language-name="javascript">Javascript</a>
                <a href="#" data-language-name="python">Python</a>
                <a href="#" data-language-name="ruby">Ruby</a>
                <a href="#" data-language-name="c">C</a>
          </div>
      </div>
    </div>
  </body>
</html>
